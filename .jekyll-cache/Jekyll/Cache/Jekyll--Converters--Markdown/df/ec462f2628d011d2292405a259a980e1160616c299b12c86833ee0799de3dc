I"€g<p><a href="https://pixabay.com/en/rocket-launch-rocket-take-off-nasa-67643/" target="_blank">
    <img src="/images/posts/coding.jpg" class="center" />
</a></p>

<p>YazÄ±lÄ±m bloglarÄ±nda tonla <strong><em>â€œNeden Test YazmalÄ±yÄ±z?â€</em></strong> baÅŸlÄ±klÄ± makaleler bulabilirsiniz. Bu nedenle bu soruyu cevaplamayacaÄŸÄ±m. EÄŸer burayÄ± okuyorsanÄ±z <strong>test</strong> kavramÄ± hakkÄ±nda en azÄ±ndan bir kaÃ§ ÅŸey duymuÅŸsunuzdur diye dÃ¼ÅŸÃ¼nÃ¼yorum.</p>

<p>Ben bu yazÄ±da bir Ã§ok farklÄ± test tÃ¼rÃ¼ olmasÄ±na raÄŸmen <strong>PHP iÃ§in Unit Test</strong> geliÅŸtirme konusunu irdelemek istiyorum. Ancak bunu yaparken herhangi bir Frameworkâ€™e baÄŸlÄ± kalmadan, iÅŸin mantÄ±ÄŸÄ±na ve neyi neden yaptÄ±ÄŸÄ±mÄ±za da <strong><em>ince ince</em></strong> deÄŸinmeÄŸi uygun buluyorum. DolayÄ±sÄ±yla bu makale sizin iÃ§in sÄ±kÄ±cÄ± geldiÄŸi an okumayÄ± bÄ±rakmanÄ±zÄ± <strong><em>Ã¶neririm</em></strong>.</p>

<h3 id="nasÄ±l">NasÄ±l?</h3>

<p>Unit Test yazmak iÃ§in <a href="https://phpunit.de/manual/current/en/installation.html">PHPUnit</a> ve <a href="https://github.com/padraic/mockery">Mockery</a> kÃ¼tÃ¼phanelerinden faydalanÄ±yoruz.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">PHPUnit</code>: Unit test yazmak iÃ§in Ã¶zel olarak geliÅŸtirilmiÅŸ bir kÃ¼tÃ¼phane. Profesyonel PHP projelerinin vazgeÃ§ilmezi.</li>
  <li><code class="language-plaintext highlighter-rouge">Mockery</code>: SÄ±nÄ±flarÄ± taklit etmemize yarayan kÃ¼tÃ¼phane, kalpazan (benim tabirim).</li>
</ul>

<h3 id="motivasyon">Motivasyon</h3>

<p>Test yazacak motivasyonu kendinizde bulamÄ±yorsanÄ±z <strong><em>Adolf Hitler</em></strong>â€˜in ÅŸu meÅŸhur sÃ¶zÃ¼nÃ¼ hatÄ±rlayÄ±n;</p>

<blockquote>
  <p>Bir gÃ¼n yazmadÄ±ÄŸÄ±m her Unit Test iÃ§in bana kÃ¼fÃ¼r edeceksiniz.</p>
</blockquote>

<h3 id="test-driven-development">Test Driven Development</h3>

<p><strong><em>â€œKodu yazmadan Ã¶nce testini yazâ€</em></strong> dediÄŸimiz bu yÃ¶ntemde, asÄ±l zor olan <strong><em>ne yazacaÄŸÄ±mÄ±zÄ±</em></strong> bilmemektir. Bu nedenle Ã¶nce ne yapacaÄŸÄ±mÄ±zÄ± anlamaya Ã§alÄ±ÅŸmak zorundayÄ±z. Bu yÃ¼zden ben test yazÄ±mÄ±ndan Ã¶nce, dokÃ¼man yazÄ±mÄ±nÄ± salÄ±k veririm.</p>

<blockquote>
  <p>Bu konu hakkÄ±nda daha Ã¶nce yazÄ±lmÄ±ÅŸ olan makaleleri inceleyebilirsiniz: <a href="https://medium.com/@fkadev/readme-driven-development-6b2082b493b7#.i5rsbp1xg">README Driven Development - Fatih Kadir AkÄ±n</a>, <a href="http://ozguradem.net/di%C4%9Fer/2014/07/18/dokuman-tabanli-gelistirme/">DokÃ¼man TabanlÄ± GeliÅŸtirme - Ã–zgÃ¼r Adem IÅŸÄ±klÄ±</a></p>
</blockquote>

<h3 id="readme-first">Readme First!</h3>

<p>Ã–rnek olarak bir <strong>UserRepository</strong> sÄ±nÄ±fÄ± -biraz basit tutmak istiyorum- yazacaÄŸÄ±z. Bu sÄ±nÄ±fÄ±n dokÃ¼mantasyonunu yazarken tek yampanÄ±z gereken: <strong><em>en kolay kullanÄ±m formunu yazmak</em></strong> olmalÄ±dÄ±r. Son derece basit deÄŸil mi?</p>

<pre><code class="language-php">
# DokÃ¼man Ã–rneÄŸi

$userRepo = new UserRepository();
$user = $userRepo-&gt;create('foo@bar.com', 'Foo Bar');
echo $user-&gt;email;  // foo@bar.com
echo $user-&gt;name;   // Foo Bar
</code></pre>

<h3 id="adÄ±m-adÄ±m-test-yapÄ±sÄ±-oluÅŸturma">AdÄ±m AdÄ±m Test YapÄ±sÄ± OluÅŸturma</h3>

<ul>
  <li>YukarÄ±daki dokÃ¼manÄ±mÄ±zÄ± ana dizine â€œReadme.mdâ€ olarak kaydedin. (<a href="https://en.wikipedia.org/wiki/Markdown">Md UzantÄ±sÄ± Nedir?</a>)</li>
  <li>Yeni bir composer yapÄ±landÄ±rma dosyasÄ± oluÅŸturun: <code class="language-plaintext highlighter-rouge">$ composer init</code> (<a href="http://www.cangelis.com/php-composer-nedir-nasil-kullanilir/">Bu nedir?</a>)</li>
  <li><strong>PHPUnit</strong>â€˜i <strong>global</strong> olarak kurun: <code class="language-plaintext highlighter-rouge">composer global require phpunit/phpunit</code></li>
  <li><strong>PHPUnit</strong>â€˜i projeye ekleyin: <code class="language-plaintext highlighter-rouge">composer require --dev phpunit/phpunit</code></li>
  <li><strong>Mockery</strong> kÃ¼tÃ¼phanesini projeye ekleyin: <code class="language-plaintext highlighter-rouge">composer require --dev mockery/mockery</code></li>
  <li>Ana dizinde <code class="language-plaintext highlighter-rouge">src</code> ve <code class="language-plaintext highlighter-rouge">tests</code>  klasÃ¶rlerinizi oluÅŸturun.</li>
  <li>PHPUnit iÃ§in ana dizinde <code class="language-plaintext highlighter-rouge">phpunit.xml</code> isimli bir yapÄ±landÄ±rma dosyasÄ± oluÅŸturun ve aÅŸaÄŸÄ±daki iÃ§eriÄŸi kaydedin;</li>
</ul>

<pre><code class="language-xml">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;phpunit backupGlobals="false"
         backupStaticAttributes="false"
         bootstrap="vendor/autoload.php"
         colors="true"
         convertErrorsToExceptions="true"
         convertNoticesToExceptions="true"
         convertWarningsToExceptions="true"
         processIsolation="false"
         stopOnFailure="true"
         syntaxCheck="false"&gt;
    &lt;testsuites&gt;
        &lt;testsuite name="Application Test Suite"&gt;
            &lt;directory&gt;./tests/&lt;/directory&gt;
        &lt;/testsuite&gt;
    &lt;/testsuites&gt;
    &lt;php&gt;
        &lt;env name="APP_ENV" value="testing"/&gt;
    &lt;/php&gt;
&lt;/phpunit&gt;
</code></pre>

<h3 id="neyi-neden-yaptÄ±k">Neyi Neden YaptÄ±k?</h3>

<p>AsÄ±l proje dosyalarÄ±mÄ±zÄ± <code class="language-plaintext highlighter-rouge">src</code>, testlerimizi de <code class="language-plaintext highlighter-rouge">tests</code> klasÃ¶rÃ¼nde barÄ±ndÄ±racaÄŸÄ±mÄ±zÄ± tahmin etmiÅŸsinizdir.</p>

<p>OluÅŸturduÄŸumuz <code class="language-plaintext highlighter-rouge">phpunit.xml</code> dosyasÄ±, PHPUnitâ€™e test yapÄ±landÄ±rmamÄ±zÄ±n nasÄ±l olduÄŸu hakkÄ±nda genel bilgiler vermek iÃ§in kullanÄ±lmaktadÄ±r ve ÅŸart deÄŸildir. Ancak yapÄ±landÄ±rma dosyamÄ±zÄ±n ana dizinde durmasÄ± bizim iÃ§in bir rahatlÄ±k olacaktÄ±r. Dikkat ederseniz son bÃ¶lÃ¼mde (&lt;php&gt; etiketinin iÃ§inde) <code class="language-plaintext highlighter-rouge">APP_ENV</code> isimli bir ortam deÄŸiÅŸkeni tanÄ±mladÄ±k. Bu tarz parametreler kullanarak uygulamÄ±nÄ±zÄ± test ortamÄ±na Ã¶zel olarak Ã§alÄ±ÅŸacak ÅŸekilde geliÅŸtirebilirsiniz.</p>

<h3 id="Ã§alÄ±ÅŸtÄ±rma">Ã‡alÄ±ÅŸtÄ±rma</h3>

<p>Åuanda herhangi bir adÄ±m atlanmadÄ±ysa konsol Ã¼zerinde aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda phpunit sorunsuz bir ÅŸekilde -inÅŸallah- bize yanÄ±t verecektir.</p>

<pre><code class="language-bash">
$ phpunit

PHPUnit 5.2.12 by Sebastian Bergmann and contributors.
Time: 147 ms, Memory: 10.50Mb
No tests executed!
</code></pre>

<blockquote>
  <p>Evet, henÃ¼z hiÃ§ bir testimiz olmadÄ±ÄŸÄ±ndan PHPUnit bize hiÃ§ bir test Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ±ÄŸÄ±nÄ± sÃ¶yledi.</p>
</blockquote>

<h3 id="Ã¶rnek-test">Ã–rnek Test</h3>

<p>Åimdi test dizinimizin altÄ±na <code class="language-plaintext highlighter-rouge">UserRepositoryTest.php</code> isimli bir dosya oluÅŸturuyor ve aÅŸaÄŸÄ±daki iÃ§eriÄŸi kopyalÄ±yoruz.</p>

<pre><code class="language-php">
class UserRepositoryTest extends PHPUnit_Framework_TestCase {

    public function testSimple()
    {
        $this-&gt;assertTrue(true);
    }

}
</code></pre>

<p>Tekrardan konsol Ã¼zerinden <code class="language-plaintext highlighter-rouge">phpunit</code> komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mÄ±zda bu sefer sonuÃ§ aÅŸaÄŸÄ±daki gibi olacaktÄ±r:</p>

<pre><code class="language-bash">
PHPUnit 5.2.12 by Sebastian Bergmann and contributors.
.                                                                   1 / 1 (100%)
Time: 134 ms, Memory: 10.75Mb
OK (1 test, 1 assertion)
</code></pre>

<blockquote>
  <p>PHPUnit bize toplamda 1 test Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ± ve 1 <strong>doÄŸrulamanÄ±n</strong> baÅŸarÄ±lÄ± bir ÅŸekilde sonuÃ§landÄ±ÄŸÄ±nÄ± gÃ¶steriyor. YeÅŸil rengi gÃ¶rdÃ¼nÃ¼z mÃ¼? Bu bize herÅŸeyin yolunda olduÄŸunu gÃ¶sterir.
Testimizi biraz incelediÄŸimizde ÅŸunlarÄ± gÃ¶rÃ¼rÃ¼z;</p>
</blockquote>

<ul>
  <li><code class="language-plaintext highlighter-rouge">UserRepositoryTest</code> isimli sÄ±nÄ±f bizim test sÄ±nÄ±fÄ±mÄ±zÄ± temsil ediyor.</li>
  <li>TÃ¼m test sÄ±nÄ±flarÄ±mÄ±zÄ± <code class="language-plaintext highlighter-rouge">PHPUnit_Framework_TestCase</code> sÄ±nÄ±fÄ±ndan geniÅŸletiyoruz. (Bu sÄ±nÄ±fÄ± bize PHPUnit saÄŸlÄ±yor)</li>
  <li>SÄ±nÄ±fÄ±n iÃ§erindeki metotlara ayrÄ± ayrÄ± testler yazabiliyoruz.</li>
  <li>Test metodu olan metotlarÄ±n isimlerini <code class="language-plaintext highlighter-rouge">test</code> ile baÅŸlatÄ±yoruz. Aksi halde PHPUnit o metotlarÄ± gÃ¶rmezden gelecektir.</li>
  <li>PHPUnitâ€™in bize saÄŸladÄ±ÄŸÄ± <strong>doÄŸrulama</strong> metotlarÄ±nÄ± kullanarak (<code class="language-plaintext highlighter-rouge">assertTrue()</code>) kontrollerimizi gerÃ§ekleÅŸtirebiliyoruz. Bu doÄŸrulama metotlarÄ±nÄ±n tamamÄ± <a href="https://phpunit.de/manual/current/en/appendixes.assertions.html">PHPUnit DokÃ¼manÄ±</a> Ã¼zerinde yer almaktadÄ±r.</li>
</ul>

<h3 id="gerÃ§ek-testimizi-yazalÄ±m">GerÃ§ek Testimizi YazalÄ±m</h3>

<p>Test sÄ±nÄ±fÄ±mÄ±zÄ±n sorunsuz olarak Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶rdÃ¼ÄŸÃ¼mÃ¼zde gerÃ§ek test kodlarÄ±nÄ± yazÄ±yoruz. Bunu yaparken aslÄ±nda daha Ã¶nceden yazdÄ±ÄŸÄ±mÄ±z dokÃ¼mana sadÄ±k kalÄ±yoruz;</p>

<pre><code class="language-php">
public function testSimple()
{
    $userRepo = new UserRepository();
    $user = $userRepo-&gt;create('foo@bar.com', 'Foo Bar');
    $this-&gt;assertEquals($user-&gt;email, 'foo@bar.com');
    $this-&gt;assertEquals($user-&gt;name, 'Foo Bar');
}
</code></pre>

<p>Dikkat ederseniz aÃ§Ä±klama satÄ±rÄ± olarak <strong><em>â€œBurada bu deÄŸeri gÃ¶rebilmem gerekiyor.â€</em></strong> dediÄŸim bÃ¶lÃ¼mler benim asÄ±l test edeceÄŸim unsurlarÄ± iÃ§eriyor. Bu testi yaparken PHPUnitâ€™in bize saÄŸladÄ±ÄŸÄ± <code class="language-plaintext highlighter-rouge">assertEquals</code> metodunu kullanÄ±yoruz ve beklediÄŸimiz ve dÃ¶nen deÄŸeri karÅŸÄ±laÅŸtÄ±rÄ±yoruz.</p>

<p>Yine konsol Ã¼zerinden <code class="language-plaintext highlighter-rouge">phpunit</code> komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mÄ±zda <code class="language-plaintext highlighter-rouge">FatalError</code> ile karÅŸÄ±laÅŸtÄ±ÄŸÄ±mÄ±zÄ± gÃ¶receksiniz.</p>

<pre><code class="language-bash">
PHPUnit 5.2.12 by Sebastian Bergmann and contributors.

PHP Fatal error:  Class 'UserRepository' not found in /home/makale/tests/UserRepositoryTest.php on line 7
Fatal error: Class 'UserRepository' not found in /home/makale/tests/UserRepositoryTest.php on line 7
</code></pre>

<p>Hemen bu sorunu aÅŸmak iÃ§in <code class="language-plaintext highlighter-rouge">src</code> klasÃ¶rÃ¼ altÄ±na <code class="language-plaintext highlighter-rouge">UserRepository.php</code> isimli dosyayÄ± aÅŸaÄŸÄ±daki gibi oluÅŸturuyoruz.</p>

<pre><code class="language-php">
class UserRepository {
}
</code></pre>

<p>Ancak <code class="language-plaintext highlighter-rouge">phpunit</code> komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±z zaman yine aynÄ± hatanÄ±n oluÅŸtuÄŸunu gÃ¶receksiniz. Buradaki sorun ilgili sÄ±nÄ±fÄ±n test bÃ¶lÃ¼mÃ¼nden ulaÅŸÄ±labilecek ÅŸekilde <code class="language-plaintext highlighter-rouge">include</code> iÅŸlemine tabi tutulmamasÄ±dÄ±r. Ancak biz <code class="language-plaintext highlighter-rouge">include</code> iÅŸlemini profesyoneller gibi composer tarafÄ±ndan bize saÄŸlanan <strong>autoload</strong> bÃ¶lÃ¼mÃ¼ne yaptÄ±racaÄŸÄ±z. (<a href="https://getcomposer.org/doc/04-schema.md#autoload">Autoload Nedir?</a>)</p>

<h3 id="autoload-iÌ‡ÅŸlemi-tanÄ±mlamasÄ±">Autoload Ä°ÅŸlemi TanÄ±mlamasÄ±</h3>

<p>Bu iÅŸlem iÃ§in ana dizinde bulunan <code class="language-plaintext highlighter-rouge">composer.json</code> dosyasÄ±na aÅŸaÄŸÄ±daki eklemeyi yapÄ±yoruz;</p>

<pre><code class="language-js">
"autoload": {
    "classmap": ["src"]
}
</code></pre>

<p>Bu eklemeden sonra konsol Ã¼zerinde <code class="language-plaintext highlighter-rouge">composer dump-autoload</code> komutunu uygulayarak otomatik olarak yÃ¼klenecek sÄ±nÄ±flarÄ±n yeniden belirlenmesini istiyoruz.</p>

<blockquote>
  <p>Autoload iÅŸleminde ben kolay olmasÄ± aÃ§Ä±sÄ±ndan tÃ¼m <code class="language-plaintext highlighter-rouge">src</code> klasÃ¶rÃ¼nÃ¼n taranmasÄ±nÄ± istedim. Ancak bu pek doÄŸru bir yaklaÅŸÄ±m deÄŸil. Bu tarz otomatik yÃ¼klemeler iÃ§in <strong>Namespace</strong> kullanmanÄ±zÄ± Ã¶neririm.</p>
</blockquote>

<h3 id="test-yazmaya-devam">Test Yazmaya Devam</h3>

<p>Bu iÅŸlemden sonra <code class="language-plaintext highlighter-rouge">phpunit</code> komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda ilgili fonksiyonun <code class="language-plaintext highlighter-rouge">UserRepository</code> iÃ§erisinde olmadÄ±ÄŸÄ±yla ilgili hatayÄ± gÃ¶receksiniz. Bu nedenle aÅŸaÄŸÄ±daki eklemeyi yapÄ±yoruz.</p>

<pre><code class="language-php">
public function create($email, $name)
{
}
</code></pre>

<p><code class="language-plaintext highlighter-rouge">phpunit</code> komutumuzu Ã§alÄ±ÅŸtÄ±rmamÄ±z sonrasÄ±nda aÅŸaÄŸÄ±daki gibi <strong>kÄ±rmÄ±zÄ±</strong> bir ekranla karÅŸÄ±laÅŸÄ±rÄ±z ve beklenen ve alÄ±nan deÄŸerlerin uyuÅŸmadÄ±ÄŸÄ±nÄ± PHPUnit bize sÃ¶yler.</p>

<pre><code class="language-bash">
PHPUnit 5.2.12 by Sebastian Bergmann and contributors.

F                                                                   1 / 1 (100%)
Time: 165 ms, Memory: 10.75Mb

There was 1 failure:
1) UserRepositoryTest::testSimple
Failed asserting that 1 matches expected null.
/home/ubuntu/workspace/makale/tests/UserRepositoryTest.php:9

FAILURES!

Tests: 1, Assertions: 1, Failures: 1.
ozziest:~/workspace/ma
</code></pre>

<h3 id="gerÃ§ek-dÃ¼nyaya-dÃ¶nmek">GerÃ§ek DÃ¼nyaya DÃ¶nmek</h3>

<p>Testimizi yeniden yeÅŸile Ã§evirmeden Ã¶nce gerÃ§ek dÃ¼nyaya dÃ¶nelim. Test yazmak bu kadar basit deÄŸil. Ã–rneÄŸimizde veritabanÄ± iÅŸlemi iÃ§in <code class="language-plaintext highlighter-rouge">Eloquent</code> isimli bir baÅŸka kÃ¼tÃ¼phane (Laravel kullananlar bilir) kullandÄ±ÄŸÄ±mÄ±zÄ± dÃ¼ÅŸÃ¼nelim. <code class="language-plaintext highlighter-rouge">Eloquent</code>â€˜Ä±n bize saÄŸladÄ±ÄŸÄ± modeli kullanarak ilgili kaydÄ± yaptÄ±mÄ±zÄ± varsayalÄ±m.</p>

<blockquote>
  <p>Neden bÃ¶yle bir varsayÄ±m yapÄ±yorum? Ã‡Ã¼nkÃ¼ her (fucking) test yazma Ã¶rneÄŸinde size baÅŸka bir yerle baÄŸlantÄ±sÄ± olmayan bir sÄ±nÄ±f anlatÄ±lÄ±r. Siz de baÄŸÄ±msÄ±z sÄ±nÄ±fla olayÄ± anladÄ±ÄŸÄ±nÄ±zÄ± dÃ¼ÅŸÃ¼nÃ¼rsÃ¼nÃ¼z. Ancak kendi projenizin baÅŸÄ±na geÃ§tiÄŸinizde kod size, siz koda bakarsÄ±nÄ±z. Oysaki test yazabilmek iÃ§in <strong><em>baÄŸÄ±msÄ±zlÄ±ÄŸÄ±nÄ± ilan etmiÅŸ sÄ±nÄ±flara</em></strong> sahip olmanÄ±z bir <strong>zorunluluktur.</strong></p>
</blockquote>

<p>Bu nedenle <code class="language-plaintext highlighter-rouge">UserRepository.php</code> iÃ§erisindeki kodumuzu <code class="language-plaintext highlighter-rouge">Eloquent</code>â€˜Ä±n bize gÃ¶sterdiÄŸi ÅŸekliyle <code class="language-plaintext highlighter-rouge">User</code> modeli Ã¼zerinden kaydedecekmiÅŸiz gibi tasarlayalÄ±m.</p>

<pre><code class="language-php">
use App\Models\User;

class UserRepository {
    
    public function create($email, $name)
    {
        $user = new User();
        $user-&gt;email = $email;
        $user-&gt;name  = $name;
        $user-&gt;save();
        
        return $user;
    }
    
}
</code></pre>

<p><code class="language-plaintext highlighter-rouge">UserRepository</code> sÄ±nÄ±fÄ±mÄ±z burada adÄ± geÃ§en <code class="language-plaintext highlighter-rouge">App\Models\User</code> isimli sÄ±nÄ±fa <strong>sÄ±kÄ± sÄ±kÄ±ya</strong> baÄŸlÄ± oldu. OlayÄ± bu noktaya getirdikten sonra hep birlikte bir kez daha tekrarlayalÄ±m:</p>

<blockquote>
  <p><strong>SÄ±kÄ± sÄ±kÄ±ya baÅŸka sÄ±nÄ±flara baÄŸlÄ± olan sÄ±nÄ±flar iÃ§in unit test yazamazsÄ±nÄ±z!</strong></p>
</blockquote>

<p>YazsanÄ±z bile kÄ±rk takla atmak zorunda kalÄ±rsÄ±nÄ±z. Bizim buradaki amacÄ±mÄ±z <code class="language-plaintext highlighter-rouge">User</code> sÄ±nÄ±fÄ±nÄ± deÄŸil, <code class="language-plaintext highlighter-rouge">UserRepository</code> sÄ±nÄ±fÄ±nÄ± test etmek. Aksi halde sadece bir <strong><em>unit</em></strong>â€˜i, <strong><em>yazÄ±lÄ±mÄ±n basit bir parÃ§asÄ±nÄ±</em></strong> test etmiÅŸ olmayÄ±z. YazdÄ±ÄŸÄ±mÄ±z ÅŸey de <strong>Unit Test</strong> olmaz. DolayÄ±sÄ±yla bu baÄŸÄ±mlÄ±lÄ±ktan kurulmamÄ±z gerekiyor.</p>

<blockquote>
  <p>Bu konu ayrÄ±ca <a href="http://tarikkaygusuz.com/post/solid-prensipleri">SOLID Prensipleri</a>â€˜yle de doÄŸrudan doÄŸruya alakalÄ± olan bir konudur. SOLID prensipleri hakkÄ±nda Ã¶ÄŸreneceÄŸiniz her ÅŸey test yazÄ±mÄ±nda size yardÄ±mcÄ± olacaktÄ±r.</p>
</blockquote>

<h3 id="dependency-injection">Dependency Injection</h3>

<p>Bu gibi durumlar iÃ§in ortaya atÄ±lan bir terimdir <strong>dependency injection</strong>. Yani ilgili baÄŸÄ±mlÄ±lÄ±klarÄ±n dÄ±ÅŸarÄ±dan gÃ¶nderilmesi iÅŸidir. BÃ¶ylece asÄ±l sÄ±nÄ±f, Ã§alÄ±ÅŸacaÄŸÄ± sÄ±nÄ±fÄ± dÄ±ÅŸarÄ±dan alÄ±r. Peki ama nasÄ±l?</p>

<pre><code class="language-php">
use Illuminate\Database\Eloquent\Model;

class UserRepository {
    
    private $model;
    
    public function __construct(Model $model)
    {
        $this-&gt;model = $model;
    }
    
    public function create($email, $name)
    {
        $this-&gt;model-&gt;email = $email;
        $this-&gt;model-&gt;name  = $name;
        $this-&gt;model-&gt;save();
        return $this-&gt;model;
    }
    
}
</code></pre>

<p>BaÄŸÄ±mlÄ±lÄ±klarÄ± dÄ±ÅŸarÄ±dan almanÄ±n en iyi yolu yapÄ±cÄ± metodu (<code class="language-plaintext highlighter-rouge">construct()</code>) kullanmaktÄ±r. BÃ¶ylece <code class="language-plaintext highlighter-rouge">UserRepository</code> sÄ±nÄ±fÄ±nÄ±n ilgili model sÄ±nÄ±fÄ± ile ilgili baÄŸlantÄ±sÄ±nÄ± kesmiÅŸ oluruz. EÄŸer dikkat ederseniz dÄ±ÅŸarÄ±dan aldÄ±ÄŸÄ±mÄ±z sÄ±nÄ±f iÃ§in <code class="language-plaintext highlighter-rouge">Illuminate\Database\Eloquent\Model</code> sÄ±fÄ±nÄ± dayatÄ±rÄ±z (bkz: <a href="https://www.sitepoint.com/type-hinting-in-php/">Type Hinting</a>).</p>

<blockquote>
  <p>Bu noktada kafa karÄ±ÅŸÄ±klÄ±ÄŸÄ± olabilir. SÄ±nÄ±f baÄŸÄ±mlÄ± olmasÄ±n dedik ve baÄŸÄ±mlÄ±lÄ±ÄŸÄ± dÄ±ÅŸarÄ±dan aldÄ±k ama yine de bir tip dayatma iÅŸlemi gerÃ§ekleÅŸtirdik. BÃ¶yle yapmamÄ±zÄ±n nedeni ufak bir kalpazanlÄ±kla harika ÅŸeyler yapacak oluÅŸumuz. Biraz daha sabÄ±rla okumaya devam edin.</p>
</blockquote>

<h3 id="mockery-iÌ‡le-kalpazanlÄ±k">Mockery Ä°le KalpazanlÄ±k</h3>

<p>Konsol Ã¼zerinden <code class="language-plaintext highlighter-rouge">phpunit</code> komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda aÅŸaÄŸÄ±daki hatayÄ± gÃ¶receksiniz;</p>

<pre><code class="language-bash">
There was 1 error:

1) UserRepositoryTest::testSimple
Argument 1 passed to UserRepository::__construct() must be an instance of Illuminate\Database\Eloquent\Model, none given, called in /home/ubuntu/workspace/makale/tests/UserRepositoryTest.php on line 7 and defined
</code></pre>

<p>Burada yapmak zorunda olduÄŸumuz; testimizde <code class="language-plaintext highlighter-rouge">UserRepository</code> sÄ±nÄ±fÄ±ndan yeni bir <code class="language-plaintext highlighter-rouge">instance</code> alÄ±rken bizden talep edilen baÄŸÄ±mlÄ±lÄ±ÄŸÄ± dÄ±ÅŸarÄ±dan gÃ¶ndermemiz. Ama amacÄ±mÄ±z sadece ve sadece <code class="language-plaintext highlighter-rouge">UserRepository</code> sÄ±nÄ±fÄ±nÄ± test etmek olduÄŸundan, gerÃ§ekte var olan <code class="language-plaintext highlighter-rouge">App\Models\User</code> sÄ±nÄ±fÄ±nÄ± <strong>gÃ¶nderemeyiz</strong>. Bu sÄ±nÄ±fÄ± <strong>taklit</strong> eden bir baÅŸka sÄ±nÄ±f kullanmamÄ±z gerekir. Bu iÅŸ iÃ§in <code class="language-plaintext highlighter-rouge">Mockery</code> kÃ¼tÃ¼phanesinden yararlanÄ±rÄ±z;</p>

<pre><code class="language-php">
$userMock = Mockery::mock('Illuminate\Database\Eloquent\Model');
$userRepo = new UserRepository($userMock);
</code></pre>

<p>YukarÄ±daki kodun ilk satÄ±rÄ±nda verdiÄŸimiz namespace tÃ¼rÃ¼nde bir taklit sÄ±nÄ±fÄ± oluÅŸturulur. Bu iÅŸlemi bu kadar kolay yapmamÄ±zÄ± saÄŸlayan <code class="language-plaintext highlighter-rouge">Mockery</code> kÃ¼tÃ¼phanesidir. Biz de oluÅŸturduÄŸumuz bu yalancÄ± sÄ±nÄ±fÄ± <code class="language-plaintext highlighter-rouge">UserReposiytory</code> sÄ±nÄ±fÄ±na gÃ¶ndeririz. Tekrar konsol Ã¼zerinde <code class="language-plaintext highlighter-rouge">phpunit</code> komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda bu sefer Ã§Ä±kacak olan hata ÅŸudur;</p>

<pre><code class="language-bash">
There was 1 error:
1) UserRepositoryTest::testSimple
BadMethodCallException: Method Mockery_0__Illuminate_Database_Eloquent_Model::save() does not exist on this mock object
</code></pre>

<p>HatayÄ± incelediÄŸimizde taklit sÄ±nÄ±fÄ±mÄ±zÄ±n <code class="language-plaintext highlighter-rouge">save</code> isimli bir metoda sahip olmadÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼rÃ¼z. Ã–zetle: <code class="language-plaintext highlighter-rouge">UserRepository</code> sÄ±nÄ±fÄ±mÄ±z gÃ¶nderdiÄŸimiz yalancÄ± sÄ±nÄ±fÄ± bir gÃ¼zel yedi. Hatta ÅŸuan ortada gerÃ§ekten (elle tutulur, somut) bir <code class="language-plaintext highlighter-rouge">User</code> sÄ±nÄ±fÄ± dahi yok. :)</p>

<p>Bundan sonrasÄ± <code class="language-plaintext highlighter-rouge">Mockery</code>â€˜nin bize saÄŸladÄ±ÄŸÄ± gÃ¼zellikleri kullanma;</p>

<pre><code class="language-php">
public function testSimple()
{
    $userMock = Mockery::mock('Illuminate\Database\Eloquent\Model')
                       -&gt;shouldReceive('save')-&gt;times(1)
                       -&gt;mock();
    
    $userRepo = new UserRepository($userMock);
    $user = $userRepo-&gt;create('foo@bar.com', 'Foo Bar');
    $this-&gt;assertEquals($user-&gt;email, 'foo@bar.com');
    $this-&gt;assertEquals($user-&gt;name, 'Foo Bar');
}
</code></pre>

<p>Taklit sÄ±nÄ±fÄ±nÄ± oluÅŸturduÄŸumuz bÃ¶lÃ¼me bakarsanÄ±z, <code class="language-plaintext highlighter-rouge">shouldReceive</code> metodu ile taklit sÄ±nÄ±fÄ±mÄ±zda <code class="language-plaintext highlighter-rouge">save</code> isimli bir metodun olmasÄ± gerektiÄŸini ve bu metodun da <strong>1 defa</strong> Ã§aÄŸÄ±rÄ±lmasÄ± gerektiÄŸini belirtiyoruz. Taklit sÄ±nÄ±fÄ±nÄ±za dilediÄŸiniz kadar metot ekleyebilirsiniz. <code class="language-plaintext highlighter-rouge">Mockery</code> bu konuda oldukÃ§a yardÄ±mcÄ± oluyor ve ihtiyacÄ±nÄ±z her ÅŸey <a href="http://docs.mockery.io/en/latest/">Mockery DokÃ¼manÄ±</a> Ã¼zerinde detaylÄ±ca anlatÄ±lmÄ±ÅŸ durumda.</p>

<p>Son bir kez <code class="language-plaintext highlighter-rouge">phpunit</code>  komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda aÅŸaÄŸÄ±daki gÃ¼zeller gÃ¼zeli ekranla karÅŸÄ±laÅŸÄ±rsÄ±nÄ±z;</p>

<pre><code class="language-bash">
PHPUnit 5.2.12 by Sebastian Bergmann and contributors.

.                                                                   1 / 1 (100%)

Time: 133 ms, Memory: 11.50Mb
OK (1 test, 2 assertions)
</code></pre>

<p>Bu noktada eÄŸer dilerseniz <code class="language-plaintext highlighter-rouge">UserRepository</code> sÄ±fÄ±ndaki <code class="language-plaintext highlighter-rouge">create</code> metodunun iÃ§eriÄŸini temizleyerek ya da bozarak, testlerin dÃ¼zgÃ¼n Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± dahi test edebilirsiniz.</p>

<h3 id="lafÄ±-Ã§ok-mu-uzatÄ±yoruz">LafÄ± Ã‡ok Mu UzatÄ±yoruz?</h3>

<p>Ä°lk baÅŸta olay bÃ¶yle gelebilir, kabul. Bunun en Ã¶nemli sebebi Ã¶rnek olarak <strong><em>basit</em></strong> bir ÅŸey seÃ§me zaruretimizin oluÅŸunu sÃ¶yleyebiliriz. Ancak gerÃ§ek hayatta sÄ±nÄ±flar daha komplikedir. Tam da bu noktada <strong>Laravel</strong>â€˜in kendi testlerinden bir bÃ¶lÃ¼m incelemek size biraz ipucu verebilir. (<a href="https://github.com/laravel/framework/blob/5.2/tests/Auth/AuthGuardTest.php">bkz</a>)</p>

<h3 id="iÌ‡ÅŸleri-otomatize-etmek">Ä°ÅŸleri Otomatize Etmek</h3>

<p>Ben iÅŸin en Ã§ok bu kÄ±smÄ±ndan zevk alÄ±yorum. <code class="language-plaintext highlighter-rouge">Laravel</code> gibi projelerin GitHub sayfalarÄ±nda yer alan yeÅŸil renkli kutucuklar hiÃ§ dikkatinizi Ã§ekti mi? <a href="https://github.com/laravel/laravel">[build-passing]</a>
Projede yapÄ±lan her deÄŸiÅŸiklikten sonra tÃ¼m testleri elle Ã§alÄ±ÅŸtÄ±rmak zahmetli olabileceÄŸinden, yapÄ±lan her deÄŸiÅŸiklik (commit) sonrasÄ± testlerinizi bir Ã§ok farklÄ± ortamda (PHP 5.5, PHP 5.6, PHP7, PHP:hhvm) sizin iÃ§in Ã§alÄ±ÅŸtÄ±ran araÃ§lar vardÄ±r. BunlarÄ±n en meÅŸhurlarÄ±ndan biri <a href="https://travis-ci.org">Travis-CI</a>. Bu iÅŸleri otomatize etmenin terminolojideki genel adÄ± da <strong>Continuous Integration</strong>â€˜dÄ±r.</p>

<p><code class="language-plaintext highlighter-rouge">Travis</code> sadece private repolar iÃ§in Ã¼cretlidir. Public olan repolarda sÄ±nÄ±rsÄ±zca kullanabilirsiniz. Tek yapmanÄ±z gereken projenize bir <code class="language-plaintext highlighter-rouge">travis.yml</code> dosyasÄ± dahil ederek Travis-GitHub entegrasyonunu yapmak.</p>

<blockquote>
  <p>Bu bÃ¶lÃ¼m ayrÄ± bir blog yazÄ±sÄ± olduÄŸu ve ben zaten hali hazÄ±rda bu yazÄ±yÄ± yeterince uzattÄ±ÄŸÄ±m iÃ§in bu bÃ¶lÃ¼me deÄŸinmiyorum. Ancak dileyenler Laravelâ€™in testleri ne durumda inceleyebilirler. (<a href="https://travis-ci.org/laravel/framework">bkz</a>)</p>
</blockquote>

<h3 id="sonuÃ§">SonuÃ§</h3>

<ul>
  <li>Proje bÃ¼yÃ¼dÃ¼kÃ§e ve bir Ã§ok farklÄ± yapÄ±dan oluÅŸtukÃ§a test yazmak zaruri bir hal alÄ±r.</li>
  <li>Bir Ã§ok farklÄ± test tÃ¼rÃ¼ vardÄ±r: Unit, Acceptance, Integration vb.</li>
  <li>Test tÃ¼rleri iÃ§in farklÄ± farklÄ± araÃ§lar vardÄ±r: <a href="http://phpunit.de">PHPUnit</a>, <a href="http:/docs.mockery.io">Mockery</a>, <a href="http://codeception.com/">CodeCeption</a>, <a href="http://www.seleniumhq.org/">Selenium</a>, <a href="http://www.phpspec.net/en/latest/">PHPSpec</a></li>
  <li>Unit Test yazabilmek iÃ§in sÄ±nÄ±flarÄ±mÄ±zÄ±n <strong>Unit</strong> olmasÄ± gerekmektedir. Gereksiz baÄŸÄ±mlÄ±lÄ±klar temizlenmeli/dÄ±ÅŸarÄ±dan dahil edilmelidir.</li>
  <li>SOLID prensipleri test yazma sÃ¼recinin olmazsa olmazÄ±dÄ±r ve Ã¶ÄŸrenilmesi elzemdir.</li>
  <li>Taklit sÄ±nÄ±flar iÅŸin Ã¶nemli bir kÄ±smÄ±nÄ± oluÅŸtururlar.</li>
  <li>Continuous Integration Ã¶nemlidir ve her fÄ±rsat bulunduÄŸu an uygulanmalÄ±dÄ±r.</li>
</ul>

<h3 id="iÌ‡leri-okumalar">Ä°leri Okumalar</h3>

<ul>
  <li><a href="http://www.softwaretesting.com.au/Why_is_Software_Testing_important.php">Why is Software Testing Important to a business?</a></li>
  <li><a href="http://www.softwaretestinghelp.com/types-of-software-testing/">Types of software Testing</a></li>
  <li><a href="https://jtreminio.com/2013/03/unit-testing-tutorial-introduction-to-phpunit/">Unit Testing Tutorial Part I: Introduction to PHPUnit</a></li>
  <li><a href="https://scotch.io/bar-talk/s-o-l-i-d-the-first-five-principles-of-object-oriented-design">S.O.L.I.D: The First 5 Principles of Object Oriented Design</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Inversion_of_control">Wiki: Inversion Of Control</a></li>
  <li><a href="http://shop.oreilly.com/product/9781783283439.do">Book: PHPUnit Essentials</a></li>
</ul>
:ET